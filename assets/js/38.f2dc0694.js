(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{502:function(s,t,a){"use strict";a.r(t);var e=a(2),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("本文以 centos 的Linux服务器为例，使用 Vsftpd 搭建被动模式的 FTP 服务。")]),s._v(" "),t("h2",{attrs:{id:"ftp-的两种模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ftp-的两种模式"}},[s._v("#")]),s._v(" FTP 的两种模式")]),s._v(" "),t("p",[s._v("FTP 存在两种模式，PORT(主动)模式和PASV(被动)模式。")]),s._v(" "),t("h3",{attrs:{id:"主动模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主动模式"}},[s._v("#")]),s._v(" 主动模式")]),s._v(" "),t("p",[t("strong",[s._v("FTP服务器“主动”去连接客户端的数据端口来传输数据。")]),s._v(" 即客户端从一个任意的非特权端口N（N>1024）连接到FTP服务器的21端口。然后客户端开始监听N+1，并发送 PORT N+1 到FTP服务器。接着服务器会从它自己的数据端口（20）连接到客户端指定的数据端口（N+1）。")]),s._v(" "),t("h3",{attrs:{id:"被动模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#被动模式"}},[s._v("#")]),s._v(" 被动模式")]),s._v(" "),t("p",[t("strong",[s._v("FTP服务器“被动”等待客户端来连接自己的数据端口。")]),s._v(" 即当开启一个FTP连接时，客户端打开两个任意的非特权本地端口（N >1024和N+1）。第一个端口连接服务器的21端口，但与主动方式的FTP不同，客户端不会提交 PORT 命令并允许服务器来回连它的数据端口，而是提交 PASV 命令。这样做的结果是服务器会开启一个任意的非特权端口（P > 1024），并发送 PORT P 命令给客户端。然后客户端发起从本地端口N+1到服务器的端口P的连接用来传送数据。(此模式下的FTP服务器不需要开启tcp 20端口)")]),s._v(" "),t("h3",{attrs:{id:"两种模式比较"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#两种模式比较"}},[s._v("#")]),s._v(" 两种模式比较")]),s._v(" "),t("p",[s._v("（1）PORT（主动）模式只要开启服务器的21和20端口，而PASV（被动）模式需要开启服务器大于1024所有tcp端口和21端口。")]),s._v(" "),t("p",[s._v("（2）从网络安全的角度来看的话似乎 PORT 模式更安全，而 PASV 更不安全，那么为什么 RFC 要在 PORT 基础再制定一个 PASV 模式呢？其实 RFC 制定 PASV 模式的主要目的是为了数据传输安全角度出发的，因为 PORT 使用固定20端口进行传输数据，那么作为黑客很容使用sniffer等探嗅器抓取 ftp 数据，这样一来通过 PORT 模式传输数据很容易被黑客窃取，因此使用 PASV 方式来架设 ftp server 是最安全绝佳方案。")]),s._v(" "),t("h2",{attrs:{id:"安装-vsftpd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-vsftpd"}},[s._v("#")]),s._v(" 安装 Vsftpd")]),s._v(" "),t("p",[s._v("1、安装")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" vsftpd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("2、设置开机启动")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" vsftpd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("3、启动 vsftpd")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl start vsftpd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("4、确认已经启动 vsftpd")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl status vsftpd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"配置-vsftpd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-vsftpd"}},[s._v("#")]),s._v(" 配置 Vsftpd")]),s._v(" "),t("p",[s._v("1、为 FTP 服务创建一个用户,并设置不能通过ssh登录")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" ftpuser\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" -s /sbin/nologin ftpuser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("或者")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -s /sbin/nologin ftpuser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("出现登录失败的情况,首先检查账号密码等设置，如果都正确那么")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.如果一直出现ftp登陆时报错，530 Login incorrect.Login failed.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.请先看看百度前三种问题是否能解决，我这是第四种，因为我没有在百度上找到我着一种。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3.cat /etc/passwd，查看你登陆的账户主目录和登陆shell对应的是什么，我的是/sbin/nologin")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4.查看cat /etc/shells是否有你用户的主目录和登陆shell,没有进行添加，保存，退出。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/shells\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5、添加/sbin/nologin,保存退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/shells\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 结果如下")]),s._v("\n/bin/sh\n/bin/bash\n/usr/bin/sh\n/usr/bin/bash\n/bin/tcsh\n/bin/csh\n/bin/ksh\n/bin/rksh\n/sbin/nologin\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6、最简单的方式直接执行下面的命令即可")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('/sbin/nologin"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/shells\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("2、设置该用户的密码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" ftpuser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("3、创建 FTP 服务使用的文件目录，并修改目录权限")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /var/ftp/ftpupload\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R ftpuser:ftpuser /var/ftp/ftpupload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("4、编辑配置文件 "),t("code",[s._v("/etc/vsftpd/vsftpd.conf")])]),s._v(" "),t("ul",[t("li",[s._v("修改 配置文件之前先备份")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.back\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("修改以下配置参数,监听 IPv4 或 IPv6 只能选择开启一个")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匿名用户的登录权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("anonymous_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NO\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地用户的登录权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("local_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将所有用户限制在主目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("chroot_local_user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动限制用户的名单")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("chroot_list_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例外用户列表文件的路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("chroot_list_file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/vsftpd/chroot_list\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启监听 IPv4 sockets")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listen")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭监听 IPv6")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#listen_ipv6=YES")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("ul",[t("li",[s._v("新增以下配置参数，开启被动模式")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地用户登录后所在目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("local_root")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/ftp/upload\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地用户访问相关，需要开启")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("allow_writeable_chroot")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启被动模式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pasv_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("YES\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 被动模式地址，本服务器的 IP 地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pasv_address")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx.xx.xxx.xx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 被动模式使用的最小、最大端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pasv_min_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pasv_max_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ul",[t("li",[s._v("创建并编辑配置中 "),t("code",[s._v("chroot_list_file")]),s._v(" 指定的例外用户列表文件")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /etc/vsftpd/chroot_list\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("重启 FTP 服务")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl restart vsftpd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"防火墙配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防火墙配置"}},[s._v("#")]),s._v(" 防火墙配置")]),s._v(" "),t("p",[s._v("禁用防火墙或者开启21端口和30000端口")]),s._v(" "),t("p",[s._v("1、禁用防火墙（不推荐）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl stop firewalld\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("2、开启21端口和40000-45000端口")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启21端口")]),s._v("\nfirewall-cmd --zone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("/tcp --permanent\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启30000端口")]),s._v("\nfirewall-cmd --zone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40000")]),s._v("-45000/tcp --permanent\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷新配置")]),s._v("\nfirewall-cmd --reload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"文件目录说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件目录说明"}},[s._v("#")]),s._v(" 文件目录说明")]),s._v(" "),t("p",[t("strong",[s._v("默认的安装位置在"),t("code",[s._v("/etc/vsftpd/")])])]),s._v(" "),t("ul",[t("li",[s._v("ftpusers \t\t\t-- 不能访问FTP用户列表\n"),t("ul",[t("li",[s._v("手动配置某某用户不能访问       --- 属于单独的限制性黑名单")])])]),s._v(" "),t("li",[s._v("user_list        --   不能访问FTP用户列表\n"),t("ul",[t("li",[s._v("这个要在"),t("code",[s._v("vsftpd.conf")]),s._v("搭配"),t("code",[s._v("userlist_deny=NO")]),s._v("或"),t("code",[s._v("userlist_deny=YES")])]),s._v(" "),t("li",[t("code",[s._v("userlist_deny=NO")]),s._v("和"),t("code",[s._v("user_list")]),s._v("中配置用户  可以访问")]),s._v(" "),t("li",[t("code",[s._v("userlist_deny=YES")]),s._v("和"),t("code",[s._v("user_list")]),s._v("中配置用户  不能访问")])])]),s._v(" "),t("li",[s._v("vsftpd.conf     --- 主配置文件")])]),s._v(" "),t("p",[t("strong",[s._v("小结：如果要配置的话在"),t("code",[s._v("ftpusers")]),s._v("配置比较方便点")])]),s._v(" "),t("h2",{attrs:{id:"vsftpd-conf-配置说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vsftpd-conf-配置说明"}},[s._v("#")]),s._v(" vsftpd.conf 配置说明")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("属性")]),s._v(" "),t("th",[s._v("属性值")]),s._v(" "),t("th",[s._v("含义")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("anonymous_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否允许匿名用户（anonymous）登录 FTP，如果该设置被注释，则默认允许")])]),s._v(" "),t("tr",[t("td",[s._v("local_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否允许本地系统用户登录")])]),s._v(" "),t("tr",[t("td",[s._v("write_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否开启任何形式的 FTP 写入命令，上传文件")])]),s._v(" "),t("tr",[t("td",[s._v("local_umask")]),s._v(" "),t("td",[s._v("xxx")]),s._v(" "),t("td",[s._v("本地用户的 umask 设置，如果注释该设置则默认为 077，但一般都设置成 022")])]),s._v(" "),t("tr",[t("td",[s._v("anon_upload_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否允许匿名用户上传文件，如果要设置为允许，则需要先开启 write_enable，否则无效，此外对应目录还要具有写权限")])]),s._v(" "),t("tr",[t("td",[s._v("anon_mkdir_write_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否允许匿名用户创建新目录")])]),s._v(" "),t("tr",[t("td",[s._v("dirmessage_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("当进入某个目录时，发送信息提示给远程用户")])]),s._v(" "),t("tr",[t("td",[s._v("xferlog_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否开启 上传/下载 的日志记录")])]),s._v(" "),t("tr",[t("td",[s._v("connect_from_port_20")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否使用 20 端口来连接 FTP")])]),s._v(" "),t("tr",[t("td",[s._v("chown_uploads")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("匿名上传的文件是否由某一指定用户 chown_username 所有")])]),s._v(" "),t("tr",[t("td",[s._v("chown_username")]),s._v(" "),t("td",[s._v("有效用户名")]),s._v(" "),t("td",[s._v("匿名上传的文件由该设定用户所有")])]),s._v(" "),t("tr",[t("td",[s._v("xferlog_file")]),s._v(" "),t("td",[s._v("有效路径")]),s._v(" "),t("td",[s._v("设置日志文件的保存位置，默认为 /var/log/xferlog")])]),s._v(" "),t("tr",[t("td",[s._v("xferlog_std_format")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否使用标准的 ftpd xferlog日志格式，该格式日志默认保存在 /var/log/xferlog")])]),s._v(" "),t("tr",[t("td",[s._v("idle_session_timeout")]),s._v(" "),t("td",[s._v("数值")]),s._v(" "),t("td",[s._v("设置空闲连接的超时时间，单位 秒")])]),s._v(" "),t("tr",[t("td",[s._v("data_connection_timeout")]),s._v(" "),t("td",[s._v("数值")]),s._v(" "),t("td",[s._v("设置等待数据传输的最大时间，单位 秒（data_connection_timeout 与 idle_session_timeout  在同一时间只有一个有效）")])]),s._v(" "),t("tr",[t("td",[s._v("nopriv_user")]),s._v(" "),t("td",[s._v("有效用户名")]),s._v(" "),t("td",[s._v("指定一个非特权用户，用于运行 vsftpd")])]),s._v(" "),t("tr",[t("td",[s._v("async_abor_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否支持异步 ABOR 请求")])]),s._v(" "),t("tr",[t("td",[s._v("ascii_upload_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否开启 ASCII 模式进行文件上传，一般不开启")])]),s._v(" "),t("tr",[t("td",[s._v("ascii_download_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否开启 ASCII 模式进行文件下载，一般不开启")])]),s._v(" "),t("tr",[t("td",[s._v("ftpd_banner")]),s._v(" "),t("td",[s._v("…")]),s._v(" "),t("td",[s._v("自定义登录标语")])]),s._v(" "),t("tr",[t("td",[s._v("deny_email_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("如果匿名登录，则会要求输入 email 地址，如果不希望一些 email 地址具有登录权限，则可以开启此项，并在  banned_email_file 指定的文件中写入对应的 email 地址")])]),s._v(" "),t("tr",[t("td",[s._v("banned_email_file")]),s._v(" "),t("td",[s._v("有效文件")]),s._v(" "),t("td",[s._v("当开启 deny_email_enable 时，需要通过此项指定一个保存登录无效 email 的文件")])]),s._v(" "),t("tr",[t("td",[s._v("chroot_local_user")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否将所有用户限制在主目录，当为 NO 时， FTP 用户可以切换到其他目录")])]),s._v(" "),t("tr",[t("td",[s._v("chroot_list_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否启用限制用户的名单列表")])]),s._v(" "),t("tr",[t("td",[s._v("chroot_list_file")]),s._v(" "),t("td",[s._v("有效文件")]),s._v(" "),t("td",[s._v("用户列表，其作用与 chroot_local_user 和 chroot_local_user 的组合有关，详见下表")])]),s._v(" "),t("tr",[t("td",[s._v("allow_writeable_chroot")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否允许用户对 ftp 根目录具有写权限，如果设置成不允许而目录实际上却具备写权限，则会报错")])]),s._v(" "),t("tr",[t("td",[s._v("ls_recurse_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否允许 ls -R 指令来递归查询，递归查询比较耗资源")])]),s._v(" "),t("tr",[t("td",[s._v("listen")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("如果为 YES，vsftpd 将以独立模式运行并监听 IPv4 的套接字，处理相关连接请求（该指令不能与 listen_ipv6 一起使用）")])]),s._v(" "),t("tr",[t("td",[s._v("listen_ipv6")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否允许监听 IPv6 套接字")])]),s._v(" "),t("tr",[t("td",[s._v("pam_service_name")]),s._v(" "),t("td",[s._v("…")]),s._v(" "),t("td",[s._v("设置 PAM 外挂模块提供的认证服务所使用的配置文件名 ，即 /etc/pam.d/vsftpd 文件，此文件中  file=/etc/vsftpd/ftpusers 字段，说明了 PAM 模块能抵挡的帐号内容来自文件 /etc/vsftpd/ftpusers 中")])]),s._v(" "),t("tr",[t("td",[s._v("userlist_enable")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否启用 user_list 文件来控制用户登录")])]),s._v(" "),t("tr",[t("td",[s._v("userlist_deny")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否拒绝 user_list 中的用户登录，此属性设置需在 userlist_enable = YES 时才有效")])]),s._v(" "),t("tr",[t("td",[s._v("tcp_wrappers")]),s._v(" "),t("td",[s._v("YES/NO")]),s._v(" "),t("td",[s._v("是否使用 tcp_wrappers 作为主机访问控制方式")])]),s._v(" "),t("tr",[t("td",[s._v("max_clients")]),s._v(" "),t("td",[s._v("数值")]),s._v(" "),t("td",[s._v("同一时间允许的最大连接数")])]),s._v(" "),t("tr",[t("td",[s._v("max_per_ip")]),s._v(" "),t("td",[s._v("数值")]),s._v(" "),t("td",[s._v("同一个IP客户端连接的最大值")])]),s._v(" "),t("tr",[t("td",[s._v("local_root")]),s._v(" "),t("td",[s._v("有效目录")]),s._v(" "),t("td",[s._v("系统用户登录后的根目录")])]),s._v(" "),t("tr",[t("td",[s._v("anon_root")]),s._v(" "),t("td",[s._v("有效目录")]),s._v(" "),t("td",[s._v("匿名用户登录后的根目录")])]),s._v(" "),t("tr",[t("td",[s._v("user_config_dir")]),s._v(" "),t("td",[s._v("有效目录")]),s._v(" "),t("td",[s._v("用户单独配置文件存放目录，该目录下用户的文件名就是对应用户名")])])])]),s._v(" "),t("p",[t("code",[s._v("chroot_local_user")]),s._v(" 和 "),t("code",[s._v("chroot_local_user")]),s._v(" 组合功能如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th"),s._v(" "),t("th",[s._v("chroot_local_user=YES")]),s._v(" "),t("th",[s._v("chroot_local_user=NO")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("chroot_list_enable=YES")]),s._v(" "),t("td",[s._v("1.所有用户都被限制在其主目录下     2.使用 "),t("code",[s._v("chroot_list_file")]),s._v(" 指定的用户列表 "),t("code",[s._v("/etc/vsftpd/chroot_list")]),s._v("，这些用户作为“例外”，不受限制")]),s._v(" "),t("td",[s._v("1.所有用户都不被限制其主目录下     2.使用 "),t("code",[s._v("chroot_list_file")]),s._v(" 指定的用户列表 "),t("code",[s._v("/etc/vsftpd/chroot_list")]),s._v("，这些用户作为“例外”，受到限制")])]),s._v(" "),t("tr",[t("td",[s._v("chroot_list_enable=NO")]),s._v(" "),t("td",[s._v("1.所有用户都被限制在其主目录下     2.不使用 "),t("code",[s._v("chroot_list_file")]),s._v(" 指定的用户列表 "),t("code",[s._v("/etc/vsftpd/chroot_list")]),s._v("，没有任何“例外”用户")]),s._v(" "),t("td",[s._v("1.所有用户都不被限制其主目录下     2.不使用 "),t("code",[s._v("chroot_list_file")]),s._v(" 指定的用户列表 "),t("code",[s._v("/etc/vsftpd/chroot_list")]),s._v("，没有任何“例外”用户")])])])]),s._v(" "),t("p",[s._v("配置文件说明来自： [juejin.cn/post/693341…")]),s._v(" "),t("h2",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态")]),s._v("\nsystemctl status vsftpd\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启")]),s._v("\nsystemctl start vsftpd\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭")]),s._v("\nsystemctl stop vsftpd\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\nsystemctl restart vsftpd \n-- 下面这种也可以\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态")]),s._v("\n/bin/systemctl status  vsftpd.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启")]),s._v("\n/bin/systemctl start  vsftpd.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭")]),s._v("\n/bin/systemctl stop  vsftpd.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\n/bin/systemctl restart  vsftpd.service\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);